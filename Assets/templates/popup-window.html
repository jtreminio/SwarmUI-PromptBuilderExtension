<!DOCTYPE html>
<html>
  <head>
    <title>Prompt Builder</title>
    {{stylesheets}}
  </head>
  <body>
    <div id="pb-popup-app"></div>
    <script>
      // Store state to restore after script loads
      window.promptBuilderState = {{state}};

      // Make parent window functions available
      window.genericRequest = function(...args) {
          return window.opener.genericRequest(...args);
      };

      // Expose SwarmUI functions from parent window
      if (window.opener.doPopover) {
          window.doPopover = function(...args) {
              return window.opener.doPopover(...args);
          };
      }

      if (window.opener.AdvancedPopover) {
          window.AdvancedPopover = window.opener.AdvancedPopover;
      }
    </script>
    <script src="/ExtensionFile/PromptBuilderExtension/Assets/prompt-builder.js?vary={{timestamp}}"></script>
    <script>
      // After the script loads, initialize with saved state
      window.addEventListener("load", () => {
        if (window.promptBuilderPopupInit) {
          window.promptBuilderPopupInit(window.promptBuilderState);
        }
      });
    </script>
  </body>
</html>
